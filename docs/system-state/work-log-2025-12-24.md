
## Session 2: File Sharing Feature + TestNet Deployment

### Work Completed

1. **File Sharing Implementation**
   - Added FILE and IMAGE message types to dtos.ts
   - Created file-relay.service.ts for S3 file storage with:
     - File validation (type + size limits)
     - Image thumbnail generation using sharp
     - Presigned URL generation for downloads
     - Conversation participant verification
   - Created file-relay.controller.ts with endpoints:
     - POST /api/v1/files/conversations/:conversationId (upload)
     - GET /api/v1/files/:fileId/url (download URL)
     - DELETE /api/v1/files/:fileId (delete)
     - GET /api/v1/files/info (supported types)
   - Added file.routes.ts with multer for upload handling
   - Updated app.ts to mount file routes
   - Added sharp dependency for image processing

2. **Supported File Types**
   - Documents: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, CSV (max 50MB)
   - Images: JPG, PNG, GIF, WEBP, HEIC, HEIF (max 10MB)
   - All files have 7-day TTL (auto-deleted from S3)

3. **TestNet Deployment**
   - Fixed CPU request issue (50m → 100m for LimitRange)
   - Fixed Redis URL encoding issue (special chars in password)
   - Created k8s/backend/testnet/svc-messaging.yaml
   - Successfully deployed and verified health endpoint

### Challenges & Solutions

1. **CPU LimitRange Violation**
   - Problem: TestNet has minimum 100m CPU requirement
   - Solution: Updated deployment manifest from 50m to 100m

2. **Redis URL Validation Failure**
   - Problem: Password contains `/` and `=` which broke Zod URL validation
   - Solution: URL-encoded password chars (%2F for /, %3D for =)

### Commits Made
- feat(svc-messaging): add file and image message types with DTOs
- feat(svc-messaging): implement file relay service with S3 storage
- feat(svc-messaging): add file relay controller for REST endpoints
- feat(svc-messaging): add file upload routes with multer middleware
- feat(svc-messaging): integrate file routes into Express application
- fix(svc-messaging): add file fields to MessageDTO in message services
- deps(svc-messaging): add sharp for image thumbnail generation
- chore(k8s): add TestNet deployment manifest for svc-messaging

### Current Status
- DevNet: ✅ Messaging + File Sharing deployed
- TestNet: ✅ Messaging + File Sharing deployed
- MainNet: Not yet deployed

## Session 3: MainNet Deployment

### Work Completed

1. **MainNet Messaging Deployment**
   - Created k8s/backend/mainnet/svc-messaging.yaml
   - 2 replicas for high availability
   - Higher resources than TestNet (500m CPU, 512Mi memory limits)
   - URL-encoded Redis password
   - Successfully deployed and verified

### Commits Made
- chore(k8s): add MainNet deployment manifest for svc-messaging

### Final Deployment Status
| Environment | Status | Replicas | Image Tag |
|-------------|--------|----------|-----------|
| DevNet | ✅ Running | 1 | file-sharing |
| TestNet | ✅ Running | 1 | file-sharing |
| MainNet | ✅ Running | 2 | file-sharing |

All environments now have messaging with file sharing support.
